<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peg Solitaire</title>
    <style>
        table { border-spacing: 5px; margin: 20px auto; }
        td { width: 50px; height: 50px; text-align: center; }
        .peg { background-color: green; cursor: pointer; }
        .empty { background-color: lightgray; }
        .blocked { background-color: white; }
    </style>
</head>
<body>
    <h1>Peg Solitaire</h1>
    <button onclick="startGame('easy')">Start Easy Mode</button>
    <button onclick="startGame('hard')">Start Hard Mode</button>
    <button onclick="undoMove()">Undo</button>
    <button onclick="resetGame()">Reset</button>
    <div id="board"></div>

    <script>
        let selectedPeg = null;
        let boardState = [];

        function createBoard(board) {
            const table = document.createElement('table');
            board.forEach((row, x) => {
                const tr = document.createElement('tr');
                row.forEach((cell, y) => {
                    const td = document.createElement('td');
                    if (cell === 1) {
                        td.className = 'peg';
                        td.onclick = () => selectPeg(x, y);
                    } else if (cell === 0) {
                        td.className = 'empty';
                        td.onclick = () => selectHole(x, y);
                    } else {
                        td.className = 'blocked';
                    }
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });
            const boardDiv = document.getElementById('board');
            boardDiv.innerHTML = '';
            boardDiv.appendChild(table);
            boardState = board;
        }

        function selectPeg(x, y) {
            selectedPeg = [x, y];
        }

        function selectHole(x, y) {
            if (selectedPeg) {
                const from = selectedPeg;
                const to = [x, y];
                fetch('/move', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ from, to })
                }).then(res => res.json())
                  .then(data => {
                    if (data.board) createBoard(data.board);
                    selectedPeg = null;
                }).catch(err => alert("Invalid move"));
            }
        }

        function startGame(mode) {
            fetch('/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ mode })
            }).then(res => res.json())
              .then(data => createBoard(data.board));
        }

        function undoMove() {
            fetch('/undo', { method: 'POST' })
                .then(res => res.json())
                .then(data => createBoard(data.board))
                .catch(err => alert("No moves to undo"));
        }

        function resetGame() {
            fetch('/reset', { method: 'POST' })
                .then(res => res.json())
                .then(data => createBoard(data.board));
        }
    </script>
</body>
</html>
